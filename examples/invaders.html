<html>
  <head>
    <link href="common/examples.css" rel="stylesheet" type="text/css">
  </head>
  <body>
    <div id="game">
      <canvas id="example" width="800" height="600"></canvas>
    </div>
    
    <script type="text/javascript" src="../build/timber.js"></script>
    <script type="text/javascript" src="common/jquery-1.6.2.js"></script>
    <script type="text/javascript">
$(document).ready(function () {


    var engine = new timber.Engine("example");
    var logger = new timber.Logger("asteroids");

    engine.environment.gravitationalConstant = 0;

    var plane = new timber.Rectangle({
        x: 500,
        y: 530,
        direction: new timber.Vector(0, 1),
        speed: 0,
        width: 10,
        height: 10
      });

    engine.add(plane);

    var nextEnemyIn = function () {
        return Math.random() * 1000;
    };

    var createEnemy = function () {
        return new timber.Rectangle({
            x: Math.random() * 800,
            y: 100,
            direction: new timber.Vector(0, 1),
            speed: Math.random() * 0.5,
            width: 20,
            height: 20,
            dragCoefficient: 0
        });
    };

    setInterval(function () {
        var e = createEnemy();
        killOnScreenLeave(e);
        e.bind('collided', function (c, other) {
            if (other instanceof timber.Circle) {
                e.destroy();
                other.destroy();
            } else if (other === plane) {
                plane.destroy();
                engine.stop();
            }
            c.resolve();
        });
        engine.add(e);
    }, 1000);

    
    var move = function (d) {
        var impulse = d.scale(0.3);
        plane.applyImpulse(impulse);
    };

    var moveRight = function () {
        move(new timber.Vector(1, 0));
    };

    var moveLeft = function () {
        move(new timber.Vector(-1, 0));
    };

    var moveUp = function () {
        move(new timber.Vector(0, -1));
    };

    var moveDown = function () {
        move(new timber.Vector(0, 1));
    };

    var killOnScreenLeave = function (e) {
        e.bind('moved', function (el) {
            if (!engine.environment.contains(el)) {
                el.destroy();
            }
        });
    };

    var addBullet = function (d) {
        var bullet = new timber.Circle({
            x: plane.x,
            y: plane.y - plane.height,
            radius: 5,
            direction: d,
            speed: 1.5,
            dragCoefficient: 0
        });
        killOnScreenLeave(bullet);
        engine.add(bullet);
    };


    var shoot = function () {
        addBullet(new timber.Vector(0, -1));
    };

    var toggle = function () {
        engine.toggle();
    };

    var report = function () {
        engine.logStatusReport();
    };
 
    $(document).keydown(function (event) {
        var key = (event.which) ? event.which : e.keyCode;

        var behaviours = {
            37 : moveLeft,
            39 : moveRight,
            38 : moveUp,
            40 : moveDown,
            32 : shoot,
            81 : toggle,
            80 : report
        };

        var callback = behaviours[key];
        if (callback) {
            callback();
        }
    });

    engine.start();

});
  </script>
    
  </body>
</html>
  
